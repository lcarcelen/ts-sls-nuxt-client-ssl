<template lang="pug">
  .h-screen.w-screen.bg-gray-200
    .h-screen
      CDotsMenuContacts
      .h-screen.overflow-hidden
        div.w-full.bg-white.shadow-xl.h-20
          div.absolute.right-0
            div.flex.items-center
              div.text-xl.pr-4.text- {{$store.getters.getcurrentUser}}
              amplify-sign-out
        CMenu
        div.block.lg_flex.justify-end.h-screen.overflow-y-scroll(class="w-full h-screen") 
          div.w-full.h-screen.overflow-y-scroll(class="w-full lg_w-6/12" :class="[ $store.getters.darkIsActive ? 'text-red-700' : 'text-green-700']") 
            CChangeMode.lg_hidden
            div.w-full.flex.justify-center
                CCard.h-16.flex.justify-content.items-center.bg-white.mb-6.mt-6.text-lg(class="w-11/12")
                  template(slot='content')
                    span.ml-4.text-3xl Logs Errores Muy Explicitos
            div.w-full.flex.justify-center.overflow-scroll-y
              CCard.justify-content.items-center.bg-white.m-8(class="w-11/12")
                template(slot='content')
                  h2.text-3xl.mt-4.pb-4.ml-4 Iniciar Sesion
                  p.text-gray-700.pb-4.ml-4 Ingresa tu email y contraseña
                  p.text-red-900.bg-red-200.rounded.ml-4(class="w-11/12") {{ messageLogin }}
                  form.w-full.ml-4
                    p(:class="[ $store.getters.darkIsActive ? 'text-red-700' : 'text-green-700']") Ingresa tu email
                    input.text-gray-700.mt-2(style="focus:outline-none" placeholder="Ingresa tu Email" type="email" v-model="form.username" class="w-11/12")
                    p(:class="[ $store.getters.darkIsActive ? 'text-red-700' : 'text-green-700']") Contraseña
                    input.mb-2.text-gray-700.mt-2(style="focus:outline-none" placeholder="Ingresa tu contraseña" type="password" v-model="form.password" class="w-11/12")
                    div.mt-8.flex.justify-content
                      button.bg-red-700.text-gray-200.text-lg.rounded-lg.py-4.shadow-xl.hover_bg-blue-700.focus_outline-none.mb-4(@click.prevent="signInInseguro" class="w-11/12" :class="[ $store.getters.darkIsActive ? 'block bg-red-700' : 'hidden']") Iniciar Sesión Inseguro
                      button.bg-red-700.text-gray-200.text-lg.rounded-lg.py-4.shadow-xl.hover_bg-blue-700.focus_outline-none.mb-4(@click.prevent="signInSeguro" class="w-11/12" :class="[ $store.getters.darkIsActive ? 'hidden' : 'block bg-green-700']") Iniciar Sesión Seguro
            div.w-full.flex.justify-center
              CCard.h-64.justify-content.items-center.bg-white.mb-6.mt-6.overflow-scroll-y(class="w-11/12")
                template(slot='content')
                  h2.text-3xl.mt-4.pb-4.ml-4(:class="[ $store.getters.darkIsActive ? 'block' : 'hidden']") Mal manejo de execpciones
                  h2.text-3xl.mt-4.pb-4.ml-4(:class="[ $store.getters.darkIsActive ? 'hidden' : 'block']") Buen manejo de execpciones
                  div.block(:class="[ $store.getters.darkIsActive ? 'block text-red-700' : 'hidden']") {{errorInseguro}}
                  div.block(:class="[ $store.getters.darkIsActive ? 'hidden' : 'block text-green-700']") {{errorSeguro}}
            div.w-full.flex.justify-center.overflow-scroll-y
              CCard.h-32.justify-content.items-center.bg-white.mb-6.mt-6(class="w-11/12")
                template(slot='content')
                  h4.text-2xl.ml-4.block Derechos Reservados CHRONOS
          div.w-full(class="w-full h-screen lg_w-3/12 overflow-y-scroll") 
            CChangeMode.hidden.md_block
            div.w-full.flex.justify-center
              CCard.h-64.flex.justify-content.items-center.bg-white.mb-6.mt-6(class="w-11/12")
                template(slot='content')
                  span.ml-4.mr-4 RESEÑA
                  span.ml-4.mr-4 Una app es vulnerable a los ataques de inyección cuando no hay un protocolo de validación, filtración o saneamiento de los datos del usuario
</template>

<script>
import { components, AmplifyEventBus } from 'aws-amplify-vue'
import { Auth } from 'aws-amplify'
import messagesJson from '~/components/mapMessage.json'
import CDotsMenuContacts from '~/components/CDotsMenuContacts.vue'
import CMenu from '~/components/CMenu.vue'
import CCard from '~/components/CCard.vue'
import CChangeMode from '~/components/CChangeMode.vue'

export default {
  components: {
    ...components,
    CDotsMenuContacts,
    CMenu,
    CCard,
    CChangeMode
  },
  data() {
    return {
      messageLogin: '',
      errorInSeguro: {},
      errorSeguro: {},
      form: {
        username: '',
        password: ''
      }
    }
  },
  methods: {
    async fetchSomething() {
      const ip = await this.$axios.$get(
        'https://km6ewh68yj.execute-api.us-east-1.amazonaws.com/dev/users',
        {
          headers: {
            'Access-Control-Allow-Origin': '*'
          }
        }
      )
      console.log(ip)
    },
    async signInInseguro() {
      const { username, password } = this.form
      try {
        await Auth.signIn(username, password)
        this.messageLogin = ''
        AmplifyEventBus.$emit('authState', 'signedIn')
      } catch (e) {
        this.errorInSeguro = e
        this.messageLogin = messagesJson[e.message]
        this.errorSeguro = this.messageLogin
        console.log(e)
      }
    },
    async signInSeguro() {
      const { username, password } = this.form
      try {
        await Auth.signIn(username, password)
        this.messageLogin = ''
        AmplifyEventBus.$emit('authState', 'signedIn')
      } catch (e) {
        console.log(e)
        this.errorInseguro = e
        this.messageLogin = messagesJson[e.message]
        this.errorSeguro = this.messageLogin
        console.log(this.errorInSeguro)
      }
    }
  }
}
</script>
